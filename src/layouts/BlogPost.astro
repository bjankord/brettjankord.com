---
import {Image} from '@astrojs/image/components';
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Bio from "../components/Bio.astro";

const {
	content: {
		title,
		description,
		pubDate,
		updatedDate,
		heroImage
	},
} = Astro.props;

// Match the `heroImage` frontmatter string to its correct
// Astro.glob() import of the file in the src/ directory.
const assets = await Astro.glob('../assets/**/*');
const heroImageAsset = assets.find(asset => {
	// If no heroImage prop set, return false
	if (!heroImage) {
		return false;
	}
	// If there is no default.src for the asset, return false
  if (!asset.default?.src) {
		return false;
	}

	const hImg = asset.default.src.includes(heroImage);
	// console.log(asset.default.src);
	return hImg;
});

const discussionUrl = `https://mobile.twitter.com/search?q=${encodeURIComponent(Astro.url)}`;
---

<html lang="en-us">
	<head>
		<BaseHead
		  title={title}
		  description={description}
		/>
		<style>
			.title {
				font-size: 2em;
				margin: 0.25em 0 0;
			}
			hr {
  		  border-top: 1px solid #DDD;
				margin: 1rem 0;
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article>
				{heroImageAsset && (
					<Image
						width={720}
						height={360}
						src={heroImageAsset.default}
						alt={title}
					/>
				)}
				<h1 class="title">{title}</h1>
				{pubDate && <time>{pubDate}</time>}
				{updatedDate && <div>Last updated on <time>{updatedDate}</time></div>}
				<hr/>
				<slot />
			</article>
			<hr/>
			<aside>
				<p>
					<a href={discussionUrl}>Discuss On Twitter</a>
				</p>
				<Bio />
			</aside>
		</main>
		<Footer />
	</body>
</html>
